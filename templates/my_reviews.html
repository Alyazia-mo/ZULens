<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Reviews - ZULens</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand d-flex align-items-center" href="/">
      <img src="../static/ZULens-logo.png" alt="ZULens Logo" class="logo">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/about-us">About Us</a></li>
            <li class="nav-item"><a class="nav-link" href="/reviews">Reviews</a></li>
            <li class="nav-item"><a class="nav-link" href="/submit-review-page">Submit a Review</a></li>
            <li class="nav-item"><a class="nav-link" href="/contact-us">Contact Us</a></li>    
            <li class="nav-item"><a class="nav-link" href="/my-reviews">My Reviews</a></li>
          
            {% if session.get('username') %}
              <li class="nav-item">
                <span class="nav-link">üëã Welcome, {{ session['username'] }}</span>
              </li>
              <li class="nav-item">
                <form action="/logout" method="post" style="display:inline;">
                    <button id="logoutBtn" class="btn btn-sm btn-outline-light ms-2">Logout</button>
                </form>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link btn btn-primary ms-2" href="/login">Login</a>
              </li>
            {% endif %}
          </ul>          
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mt-4">
    <h2 class="text-center">My Submitted Reviews</h2>
    <div id="my-review-list" class="row gy-4 mt-4 text-center"></div>
  </div>

  <!-- Footer -->
  <footer class="text-center p-3 mt-4" style="background-color: #5A002B; color: white;">
    <p>¬© 2025 ZULens - AI-Powered Reviews for Zayed University</p>
  </footer>

  <!-- Script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("/get-my-reviews")
        .then(res => {
          if (res.status === 401) {
            window.location.href = "/login";
            return;
          }
          return res.json();
        })
        .then(data => {
          const container = document.getElementById("my-review-list");
          if (!data || data.length === 0) {
            container.innerHTML = "<p>No reviews yet.</p>";
            return;
          }
    
          data.forEach((r, index) => {
            container.innerHTML += `
              <div class="card mb-3 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">${r.course} ‚Äî ${r.instructor}</h5>
                  <p><strong>Rating:</strong> ${r.rating} / 5</p>
                  <p><strong>Sentiment:</strong> ${r.sentiment}</p>
                  <p><strong>Summary:</strong> ${r.summary}</p>
                  <p><strong>Review:</strong> "${r.review}"</p>
                  ${r.flagged ? '<span class="badge bg-danger">‚ö†Ô∏è Flagged</span>' : ''}
                  <button class="btn btn-sm btn-danger mt-2" onclick="deleteReview(${r.id})">üóë Delete</button>
                </div>
              </div>
            `;
          });
        });
    });
    
    function deleteReview(id) {
      fetch("/delete-review-by-id", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ review_id: id })
      })
      .then(res => res.json())
      .then(data => {
        alert("‚úÖ Review deleted");
        window.location.reload();
      });
    }
    </script>    
</body>
</html>
